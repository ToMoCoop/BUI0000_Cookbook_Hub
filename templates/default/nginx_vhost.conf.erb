server {

  server_name <%= @hostname %>;
  listen <%= @listen_port %>;

<% if @ssl_key && @ssl_cert -%>
  ssl on;
  ssl_certificate     <%= @ssl_cert %>;
  ssl_certificate_key <%= @ssl_key %>;
  ssl_protocols SSLv3 TLSv1;
  ssl_ciphers ECDHE-RSA-AES256-SHA384:AES256-SHA256:RC4:HIGH:!MD5:!aNULL:!EDH:!AESGCM;
  ssl_prefer_server_ciphers on;
<% end -%>

  access_log <%= @log_dir %>/<%= @appname %>-access.log combined;
  error_log  <%= @log_dir %>/<%= @appname %>-error.log;

  rewrite_log on;

  location / {

    proxy_set_header X-Forwarded-Host $http_host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_http_version 1.1;

    proxy_pass <%= @upstream_url %>;

  }
}


